{"version":3,"file":"baseProvider.cjs.js","mappings":"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","sources":["webpack://@web3auth/base-provider/webpack/bootstrap","webpack://@web3auth/base-provider/webpack/runtime/compat get default export","webpack://@web3auth/base-provider/webpack/runtime/define property getters","webpack://@web3auth/base-provider/webpack/runtime/hasOwnProperty shorthand","webpack://@web3auth/base-provider/webpack/runtime/make namespace object","webpack://@web3auth/base-provider/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@web3auth/base-provider/external commonjs2 \"@toruslabs/base-controllers\"","webpack://@web3auth/base-provider/external commonjs2 \"@web3auth/base\"","webpack://@web3auth/base-provider/external commonjs2 \"eth-rpc-errors\"","webpack://@web3auth/base-provider/./src/baseProvider.ts","webpack://@web3auth/base-provider/external commonjs2 \"@toruslabs/openlogin-jrpc\"","webpack://@web3auth/base-provider/./src/commonPrivateKeyProvider.ts","webpack://@web3auth/base-provider/external commonjs2 \"json-rpc-random-id\"","webpack://@web3auth/base-provider/./src/utils.ts","webpack://@web3auth/base-provider/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/base-controllers\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@web3auth/base\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"eth-rpc-errors\");","import { BaseConfig, BaseController, BaseState, createEventEmitterProxy, SafeEventEmitterProvider } from \"@toruslabs/base-controllers\";\nimport { CustomChainConfig, WalletInitializationError } from \"@web3auth/base\";\nimport { ethErrors } from \"eth-rpc-errors\";\n\nimport { IBaseProvider } from \"./IBaseProvider\";\n\nexport interface BaseProviderState extends BaseState {\n  chainId: string;\n}\n\nexport interface BaseProviderConfig extends BaseConfig {\n  chainConfig: Partial<CustomChainConfig>;\n  networks?: Record<string, CustomChainConfig>;\n  skipLookupNetwork?: boolean;\n}\n\nexport abstract class BaseProvider<C extends BaseProviderConfig, S extends BaseProviderState, P>\n  extends BaseController<C, S>\n  implements IBaseProvider<P>\n{\n  // should be Assigned in setupProvider\n  public _providerEngineProxy: SafeEventEmitterProvider | null = null;\n\n  constructor({ config, state }: { config: C; state?: S }) {\n    super({ config, state });\n    if (!config.chainConfig) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainConfig\");\n    if (!config.chainConfig.chainId) throw WalletInitializationError.invalidProviderConfigError(\"Please provide chainId inside chainConfig\");\n    if (!config.chainConfig.rpcTarget) throw WalletInitializationError.invalidProviderConfigError(\"Please provide rpcTarget inside chainConfig\");\n    this.defaultState = {\n      chainId: \"loading\",\n    } as S;\n    this.defaultConfig = {\n      chainConfig: config.chainConfig,\n      networks: { [config.chainConfig.chainId]: config.chainConfig },\n    } as C;\n    super.initialize();\n  }\n\n  get provider(): SafeEventEmitterProvider | null {\n    return this._providerEngineProxy;\n  }\n\n  set provider(_) {\n    throw new Error(\"Method not implemented.\");\n  }\n\n  public addChain(chainConfig: CustomChainConfig): void {\n    if (!chainConfig.chainId) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n    if (!chainConfig.rpcTarget) throw ethErrors.rpc.invalidParams(\"chainId is required\");\n    this.configure({\n      networks: { ...this.config.networks, [chainConfig.chainId]: chainConfig },\n    } as C);\n  }\n\n  public getChainConfig(chainId: string): CustomChainConfig | null {\n    const chainConfig = this.config.networks?.[chainId];\n    if (!chainConfig) throw ethErrors.rpc.invalidRequest(`Chain ${chainId} is not supported, please add chainConfig for it`);\n    return chainConfig;\n  }\n\n  protected getProviderEngineProxy(): SafeEventEmitterProvider | null {\n    return this._providerEngineProxy;\n  }\n\n  protected updateProviderEngineProxy(providerEngineProxy: SafeEventEmitterProvider) {\n    if (this._providerEngineProxy) {\n      (this._providerEngineProxy as any).setTarget(providerEngineProxy);\n    } else {\n      this._providerEngineProxy = createEventEmitterProxy<SafeEventEmitterProvider>(providerEngineProxy);\n    }\n  }\n\n  abstract setupProvider(provider: P): Promise<void>;\n\n  abstract switchChain(params: { chainId: string }): Promise<void>;\n\n  protected abstract lookupNetwork(provider?: P): Promise<string | void>;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/openlogin-jrpc\");","import { createEventEmitterProxy, providerFromEngine, SafeEventEmitterProvider } from \"@toruslabs/base-controllers\";\nimport { createAsyncMiddleware, createScaffoldMiddleware, JRPCEngine, JRPCMiddleware, JRPCRequest, JRPCResponse } from \"@toruslabs/openlogin-jrpc\";\nimport { CustomChainConfig } from \"@web3auth/base\";\n\nimport { IBaseProvider } from \"./IBaseProvider\";\n\nexport class CommonPrivateKeyProvider implements IBaseProvider<string> {\n  // should be Assigned in setupProvider\n  public _providerEngineProxy: SafeEventEmitterProvider | null = null;\n\n  get provider(): SafeEventEmitterProvider | null {\n    return this._providerEngineProxy;\n  }\n\n  set provider(_) {\n    throw new Error(\"Method not implemented.\");\n  }\n\n  public static getProviderInstance = async (params: { privKey: string }): Promise<CommonPrivateKeyProvider> => {\n    const providerFactory = new CommonPrivateKeyProvider();\n    await providerFactory.setupProvider(params.privKey);\n    return providerFactory;\n  };\n\n  addChain(_: CustomChainConfig): void {\n    throw new Error(\"Method not implemented.\");\n  }\n\n  public async setupProvider(privKey: string): Promise<void> {\n    const privKeyMiddleware = this.getPrivKeyMiddleware(privKey);\n    const engine = new JRPCEngine();\n    engine.push(privKeyMiddleware);\n    const provider = providerFromEngine(engine);\n    this.updateProviderEngineProxy(provider);\n  }\n\n  public async switchChain(_: { chainId: string }): Promise<void> {\n    return Promise.resolve();\n  }\n\n  protected getProviderEngineProxy(): SafeEventEmitterProvider | null {\n    return this._providerEngineProxy;\n  }\n\n  protected updateProviderEngineProxy(providerEngineProxy: SafeEventEmitterProvider) {\n    if (this._providerEngineProxy) {\n      (this._providerEngineProxy as any).setTarget(providerEngineProxy);\n    } else {\n      this._providerEngineProxy = createEventEmitterProxy<SafeEventEmitterProvider>(providerEngineProxy);\n    }\n  }\n\n  private getPrivKeyMiddleware(privKey: string): JRPCMiddleware<unknown, unknown> {\n    const middleware = {\n      getPrivatekey: async (): Promise<string> => {\n        return privKey;\n      },\n    };\n    return this.createPrivKeyMiddleware(middleware);\n  }\n\n  private createPrivKeyMiddleware({ getPrivatekey }): JRPCMiddleware<unknown, unknown> {\n    async function getPrivatekeyHandler(_: JRPCRequest<{ privateKey: string }[]>, res: JRPCResponse<unknown>): Promise<void> {\n      res.result = await getPrivatekey();\n    }\n\n    return createScaffoldMiddleware({\n      private_key: createAsyncMiddleware(getPrivatekeyHandler),\n    });\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"json-rpc-random-id\");","import getCreateRandomId from \"json-rpc-random-id\";\nexport const createRandomId = getCreateRandomId();\n","export * from \"./baseProvider\";\nexport * from \"./commonPrivateKeyProvider\";\nexport * from \"./IBaseProvider\";\nexport * from \"./utils\";\n"],"names":["BaseController","createEventEmitterProxy","WalletInitializationError","ethErrors","BaseProvider","constructor","config","state","chainConfig","invalidProviderConfigError","chainId","rpcTarget","defaultState","defaultConfig","networks","initialize","provider","_providerEngineProxy","_","Error","addChain","rpc","invalidParams","configure","getChainConfig","invalidRequest","getProviderEngineProxy","updateProviderEngineProxy","providerEngineProxy","setTarget","providerFromEngine","createAsyncMiddleware","createScaffoldMiddleware","JRPCEngine","CommonPrivateKeyProvider","setupProvider","privKey","privKeyMiddleware","getPrivKeyMiddleware","engine","push","switchChain","Promise","resolve","middleware","getPrivatekey","createPrivKeyMiddleware","getPrivatekeyHandler","res","result","private_key","params","providerFactory","getCreateRandomId","createRandomId"],"sourceRoot":""}